<!DOCTYPE html>
<html lang="en">

<head>
  <!-- put this at the top of <head>, before the app bundle -->

  <script>
    (function () {
      // Parse URL parameters for event info
      const urlParams = new URLSearchParams(window.location.search);
      const eventId = urlParams.get('open');
      const eventName = urlParams.get('name');

      // Default meta values
      let title = 'Urban pH Events';
      let description = 'Join our urban ph community for exciting walks, photo hunts, workshops, and exhibitions.';
      let image = 'https://urbanph.it/camera-icon.svg'; 
      let url = window.location.href;

      // If we have event info in URL, customize meta tags
      if (eventId && eventName) {
        const eventTitle = eventName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        title = `${eventTitle} - Urban pH`;
        description = `Join us for ${eventTitle}. Book your spot now!`;
      }

      // Set document title immediately
      document.title = title;

      // Create meta tags
      const metaTags = [
        { name: 'description', content: description },
        { property: 'og:title', content: title },
        { property: 'og:description', content: description },
        { property: 'og:image', content: image },
        { property: 'og:url', content: url },
        { property: 'og:type', content: 'website' },
        { property: 'og:site_name', content: 'Urban pH' },
        { name: 'twitter:card', content: 'summary_large_image' },
        { name: 'twitter:title', content: title },
        { name: 'twitter:description', content: description },
        { name: 'twitter:image', content: image }
      ];

      // Add meta tags to head
      metaTags.forEach(tag => {
        const meta = document.createElement('meta');
        if (tag.name) meta.name = tag.name;
        if (tag.property) meta.property = tag.property;
        meta.content = tag.content;
        document.head.appendChild(meta);
      });
    })();
  </script>

  <script>
    (function () {
      var l = window.location;

      // Detect our encoded redirect format: ?~<encoded>
      if (l.search && l.search.indexOf('?~') === 0) {
        var base =
          (document.querySelector('base') && document.querySelector('base').getAttribute('href')) ||
          '/';

        var decoded = decodeURIComponent(l.search.slice(2)); // remove "?~"
        // decoded looks like "/events?open=...#..."
        // Ensure we don't duplicate slashes when joining base + decoded
        if (decoded.charAt(0) === '/') decoded = decoded.slice(1);
        var restored = base + decoded;

        history.replaceState(null, '', restored);
      }

      // Helps with iOS weirdness around automatic scroll restore
      if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
      }
    })();
  </script>

  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="camera-icon.svg" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Urban pH</title>
</head>

<body>
  <div id="root"></div>
  <script type="module">
    // Rehydrate path written by 404.html on GitHub Pages
    const l = window.location;
    if (l.search && l.search.startsWith('?/')) {
      const decoded = l.search.slice(1).replace(/~and~/g, '&'); // drop '?', restore '&'
      const parts = decoded.split('?');
      const path = parts[0].slice(1);                        // drop leading '/'
      const query = parts[1] ? ('?' + parts[1]) : '';
      const hash = l.hash || '';
      const base = (import.meta.env.BASE_URL || '/');        // '/' in dev, '/urban-ph/' in build
      window.history.replaceState(null, null, base + path + query + hash);
    }
  </script>
  <!-- The path will be handled by Vite during build -->
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>