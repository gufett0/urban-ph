/* ========================================
   MOBILE VIEWPORT STABILIZATION SOLUTION
   ======================================== */

/* Modern CSS Viewport Units (iOS 15.4+, Android Chrome 108+) */
:root {
  /* Dynamic viewport units - responds to browser UI changes */
  --viewport-height: 100dvh;
  
  /* Large viewport units - ignores browser UI (always full screen) */
  --stable-viewport-height: 100lvh;
  
  /* Small viewport units - includes browser UI (minimum height) */
  --safe-viewport-height: 100svh;
  
  /* Custom property for JS-controlled height */
  --js-viewport-height: 100vh;
  
  /* Flag to track if viewport is stable */
  --viewport-stable: 1;
}

/* Primary viewport stabilization */
html {
  /* Use large viewport height to prevent resizing */
  height: var(--stable-viewport-height);
  height: var(--js-viewport-height);
  
  /* Fallback for older browsers */
  height: 100vh;
  
  /* Prevent elastic scrolling */
  overflow: hidden;
  
  /* iOS specific */
  height: -webkit-fill-available;
}

body {
  /* Match html height */
  min-height: var(--stable-viewport-height);
  min-height: var(--js-viewport-height);
  min-height: 100vh;
  min-height: -webkit-fill-available;
  
  /* Enable scrolling on body instead of html */
  overflow-y: auto;
  overflow-x: hidden;
  
  /* iOS momentum scrolling */
  -webkit-overflow-scrolling: touch;
  
  /* Prevent bouncing */
  overscroll-behavior: none;
}

#root {
  /* Ensure full height container */
  min-height: inherit;
  
  /* Force GPU acceleration for smoother rendering */
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
}

/* =====================================
   ENHANCED MOBILE-SPECIFIC FIXES
   ===================================== */

@media (max-width: 768px) {
  /* Viewport meta tag should be: width=device-width, initial-scale=1.0, viewport-fit=cover */
  
  html {
    /* More aggressive height fixing for mobile */
    height: 100vh !important;
    height: var(--js-viewport-height) !important;
    position: fixed;
    width: 100%;
    overflow: hidden;
  }
  
  body {
    height: 100vh !important;
    height: var(--js-viewport-height) !important;
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
    
    /* Prevent zoom on double tap */
    touch-action: manipulation;
    
    /* iOS specific optimizations */
    -webkit-text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
  }
  
  /* Prevent iOS Safari bottom bar from affecting layout */
  .ios-safari body {
    height: -webkit-fill-available !important;
    min-height: -webkit-fill-available !important;
  }
  
  /* Android Chrome specific fixes */
  .android-chrome body {
    height: calc(100vh - env(keyboard-inset-height, 0px));
  }
}

/* =====================================
   SAFE AREA SUPPORT (notch devices)
   ===================================== */

@supports (height: 100dvh) {
  :root {
    --viewport-height: 100dvh;
    --safe-viewport-height: calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  }
}

/* Support for devices with dynamic island / notch */
@supports (padding: max(0px)) {
  .safe-area-container {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* =====================================
   ANIMATION OPTIMIZATIONS
   ===================================== */

/* Reduce animation complexity when viewport is unstable */
@media (max-width: 768px) {
  * {
    /* Force hardware acceleration */
    transform: translate3d(0, 0, 0);
  }
  
  /* Optimize transitions during scroll */
  .scrolling * {
    transition-duration: 0.1s !important;
    animation-duration: 0.1s !important;
  }
  
  /* Disable problematic animations during viewport changes */
  .viewport-changing * {
    transition: none !important;
    animation: none !important;
  }
}