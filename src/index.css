@tailwind base;
@tailwind components;
@tailwind utilities;

html {
  scroll-behavior: smooth;
}

/* Font setup */
body {
  @apply font-sans;
}

/* Fix per il viewport dinamico mobile - più aggressivo */
:root {
  --viewport-height: 100vh;
}

/* Su dispositivi touch, usa la dynamic viewport unit */
@supports (height: 100dvh) {
  :root {
    --viewport-height: 100dvh; /* Dynamic viewport height */
  }
}

/* Per iOS Safari e altri browser webkit */
@supports (-webkit-appearance: none) and (stroke-color: transparent) {
  :root {
    --viewport-height: 100vh;
    --viewport-height: -webkit-fill-available;
  }
}

/* Applica l'altezza dinamica agli elementi che usano min-h-screen */
.min-h-screen {
  min-height: var(--viewport-height) !important;
}

/* iOS specific: Momentum scrolling and viewport stabilization */
@supports (-webkit-overflow-scrolling: touch) {
  html {
    height: -webkit-fill-available;
  }
  body {
    min-height: -webkit-fill-available;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  #root {
    min-height: -webkit-fill-available;
    display: flex;
    flex-direction: column;
  }
}

/* Dynamic height fix for iOS (will be set via JS) */
body, #root {
  height: auto !important; /* Override if JS sets it */
}

/* GPU acceleration for animations (add to EventCard/Info wrappers) */
.animated-element, .event-card, .info-section {
  will-change: transform, opacity;
  backface-visibility: hidden; /* Extra for iOS jank */
  transform: translate3d(0, 0, 0); /* Force hardware acceleration */
}

/* Reduce height transition duration on mobile to minimize jank */
@media (max-width: 768px) {
  .transition-height {
    transition-duration: 200ms !important; /* Shorter for smoother feel */
  }
}

/* Stabilizza il contenuto durante lo scroll su mobile */
@media (max-width: 768px) and (hover: none) and (pointer: coarse) {
  /* Riduce il jank durante gli scroll rapidi */
  * {
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
  
  /* Stabilizza la sezione Hero che probabilmente causa il glitch principale */
  .relative.min-h-screen {
    height: var(--viewport-height);
    min-height: var(--viewport-height);
    overflow: hidden; /* Previene scroll inaspettati */
  }
  
  /* Forza una stabilità maggiore per gli elementi posizionati in modo assoluto */
  .absolute {
    will-change: auto; /* Riduce l'overhead GPU se non necessario */
  }
}

/* Migliora la gestione dello scroll su iOS */
@media (max-width: 768px) {
  html {
    /* Stabilizza l'altezza durante le transizioni della barra del browser */
    height: var(--viewport-height);
    height: 100%;
  }
  
  body {
    /* Previene il bounce scroll che può peggiorare il glitch */
    overscroll-behavior-y: none;
    /* Usa l'altezza stabile */
    min-height: var(--viewport-height);
  }
  
  /* Ottimizzazione per ridurre i repaint */
  #root {
    contain: layout style paint;
  }
}